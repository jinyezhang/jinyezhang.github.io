<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>sheetJs 实现表格的导出 | 个人主页</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/images/photo.jpg">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/images/photo.jpg">
    <meta name="description" content="张金叶的博客">
    <meta http-quiv="pragma" cotent="no-cache">
    <meta http-quiv="pragma" cotent="no-cache,must-revalidate">
    <meta http-quiv="expires" cotent="0">
    
    <link rel="preload" href="/assets/css/0.styles.18d9004a.css" as="style"><link rel="preload" href="/assets/js/app.d1c6ccf3.js" as="script"><link rel="preload" href="/assets/js/2.2a0560b8.js" as="script"><link rel="preload" href="/assets/js/22.de8fc4c8.js" as="script"><link rel="prefetch" href="/assets/js/10.ea6fcdd2.js"><link rel="prefetch" href="/assets/js/11.87fe992e.js"><link rel="prefetch" href="/assets/js/12.78139d41.js"><link rel="prefetch" href="/assets/js/13.c8c4da0a.js"><link rel="prefetch" href="/assets/js/14.f4a1f006.js"><link rel="prefetch" href="/assets/js/15.581cf89d.js"><link rel="prefetch" href="/assets/js/16.0dfacd79.js"><link rel="prefetch" href="/assets/js/17.2df25cd4.js"><link rel="prefetch" href="/assets/js/18.b50da5cf.js"><link rel="prefetch" href="/assets/js/19.5da51009.js"><link rel="prefetch" href="/assets/js/20.beb6a368.js"><link rel="prefetch" href="/assets/js/21.62cec721.js"><link rel="prefetch" href="/assets/js/23.2f2de086.js"><link rel="prefetch" href="/assets/js/24.3043d38f.js"><link rel="prefetch" href="/assets/js/25.c453f23c.js"><link rel="prefetch" href="/assets/js/26.bcef791c.js"><link rel="prefetch" href="/assets/js/27.c5e2e321.js"><link rel="prefetch" href="/assets/js/28.9810b5d7.js"><link rel="prefetch" href="/assets/js/29.ee70c5e5.js"><link rel="prefetch" href="/assets/js/3.4c226bd4.js"><link rel="prefetch" href="/assets/js/4.a981af59.js"><link rel="prefetch" href="/assets/js/5.b054db93.js"><link rel="prefetch" href="/assets/js/6.2996ace1.js"><link rel="prefetch" href="/assets/js/7.084bfa88.js"><link rel="prefetch" href="/assets/js/8.7dc397ef.js"><link rel="prefetch" href="/assets/js/9.c0d7f8d8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.18d9004a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">个人主页</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博文" class="dropdown-title"><span class="title">博文</span> <span class="arrow down"></span></button> <button type="button" aria-label="博文" class="mobile-dropdown-title"><span class="title">博文</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/elementUi/" class="nav-link">
  ElementUi
</a></li><li class="dropdown-item"><!----> <a href="/jquery/" class="nav-link router-link-active">
  Jquery
</a></li><li class="dropdown-item"><!----> <a href="/browser/" class="nav-link">
  浏览器
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/jinyezhang" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博文" class="dropdown-title"><span class="title">博文</span> <span class="arrow down"></span></button> <button type="button" aria-label="博文" class="mobile-dropdown-title"><span class="title">博文</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/elementUi/" class="nav-link">
  ElementUi
</a></li><li class="dropdown-item"><!----> <a href="/jquery/" class="nav-link router-link-active">
  Jquery
</a></li><li class="dropdown-item"><!----> <a href="/browser/" class="nav-link">
  浏览器
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/jinyezhang" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>组织架构图</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>递归</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>for循环中的闭包问题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>导入与导出</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>sheetJs+xlsx-style实现导入导出</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/jquery/sheetJs+xlsx-style.html" aria-current="page" class="active sidebar-link">sheetJs 实现表格的导出</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/jquery/sheetJs+xlsx-style.html#_1-关于sheetjs的部分资料" class="sidebar-link">1.关于sheetJs的部分资料</a></li><li class="sidebar-sub-header"><a href="/jquery/sheetJs+xlsx-style.html#_2-关于excel的导入功能" class="sidebar-link">2.关于excel的导入功能</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="sheetjs-实现表格的导出"><a href="#sheetjs-实现表格的导出" class="header-anchor">#</a> sheetJs 实现表格的导出</h1> <p>在之前的工作中，一般遇到表格的导出，都是后端提供一个接口，然后通过调取导出接口，获取到文档流或者文档链接，最常见的方式就是返回文档流，然后前端实现表格的下载，完成导出的功能。</p> <p>最近在做一个表格时，后端要求前端来实现表格的导出，页面中已存在表格的情况下，将表格导出。</p> <p>此时可以使用<code>sheetJs</code>插件来实现。</p> <p><a href="https://docs.sheetjs.com/#json" target="_blank" rel="noopener noreferrer">sheetJs 社区版网址：https://docs.sheetjs.com/#json<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://blog.csdn.net/qq_35606400/article/details/112348670" target="_blank" rel="noopener noreferrer">大神关于 sheetJs 设置的技术文档：https://blog.csdn.net/qq_35606400/article/details/112348670<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="https://img-blog.csdnimg.cn/3797f9c581b04a918f0cc09a706b9c26.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAeWVoYW9jaGVuZzUyMA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述">
安装方式：
<img src="https://img-blog.csdnimg.cn/164a7074d11a48259784104f79bbfbf2.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAeWVoYW9jaGVuZzUyMA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述">
由于我这边是<code>MVC</code>的框架，因此是通过<code>script</code>引入的方式来处理的。</p> <p>页面具体渲染如下：
<img src="https://img-blog.csdnimg.cn/4732ade36b994dec8a3842410f8c7806.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAeWVoYW9jaGVuZzUyMA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p> <h1 id="_1-给el-table添加ref-用于获取table元素"><a href="#_1-给el-table添加ref-用于获取table元素" class="header-anchor">#</a> 1.给<code>el-table</code>添加<code>ref</code>，用于获取<code>table</code>元素</h1> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>el<span class="token operator">-</span>table <span class="token operator">:</span>data<span class="token operator">=</span><span class="token string">&quot;tableData1&quot;</span> border stripe <span class="token operator">:</span>height<span class="token operator">=</span><span class="token string">&quot;screenHeight-50&quot;</span> v<span class="token operator">-</span>loading<span class="token operator">=</span><span class="token string">&quot;listLoading&quot;</span> ref<span class="token operator">=</span><span class="token string">&quot;table1&quot;</span><span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>el<span class="token operator">-</span>table<span class="token operator">-</span>column label<span class="token operator">=</span><span class="token string">&quot;序号&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;index&quot;</span> align<span class="token operator">=</span><span class="token string">&quot;center&quot;</span><span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>table<span class="token operator">-</span>column<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>table<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>由于我这边是有多个工作簿的，因此每个<code>table</code>组件都需要添加<code>ref</code></p> <h1 id="_2-根据ref获取table组件也就是dom元素"><a href="#_2-根据ref获取table组件也就是dom元素" class="header-anchor">#</a> 2.根据<code>ref</code>获取<code>table</code>组件也就是<code>dom</code>元素</h1> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> table_dom <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">[</span><span class="token string">&quot;table1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>$el<span class="token punctuation">;</span>
<span class="token keyword">var</span> table_dom2 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">[</span><span class="token string">&quot;table2&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>$el<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h1 id="_3-将dom转化为book工作表"><a href="#_3-将dom转化为book工作表" class="header-anchor">#</a> 3.将<code>dom</code>转化为<code>book</code>工作表</h1> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//创建工作表</span>
<span class="token keyword">const</span> new_book <span class="token operator">=</span> <span class="token constant">XLSX</span><span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">book_new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//创建工作簿</span>
<span class="token keyword">const</span> new_sheet <span class="token operator">=</span> <span class="token constant">XLSX</span><span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">table_to_sheet</span><span class="token punctuation">(</span>table_dom<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> new_sheet2 <span class="token operator">=</span> <span class="token constant">XLSX</span><span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">table_to_sheet</span><span class="token punctuation">(</span>table_dom2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h1 id="_4-给每个工作簿设置单元格宽度"><a href="#_4-给每个工作簿设置单元格宽度" class="header-anchor">#</a> 4.给每个工作簿设置单元格宽度</h1> <p>估计有简单方法吧，但是我这边没有找到，因此是对每一列都进行了设置，比较小的就设置<code>width</code>为 5，大点的就设置为 15 等。
注意是给工作簿中的<code>!cols</code>字段设置，而且此属性值是一个数组格式的。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>new_sheet<span class="token punctuation">[</span><span class="token string">&quot;!cols&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">15</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">15</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">15</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">15</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h1 id="_5-给指定单元格设置单元格格式-比如-格式"><a href="#_5-给指定单元格设置单元格格式-比如-格式" class="header-anchor">#</a> 5.给指定单元格设置单元格格式，比如%格式</h1> <p>如下图所示：列名为<code>I</code> <code>J</code> <code>K</code>的时候，需要将单元格内容转为 0.00%的格式。
<img src="https://img-blog.csdnimg.cn/d1ede47aef80476b92478875ee552303.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAeWVoYW9jaGVuZzUyMA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"> <img src="https://img-blog.csdnimg.cn/83b6012f759b4830a1c3d63c9d0b9889.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAeWVoYW9jaGVuZzUyMA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述">
根据上图可以看出单元格格式的设置方式就是给每一项添加一个<code>z</code>，<code>z</code>对应的格式如下：
<img src="https://img-blog.csdnimg.cn/0aa3fa841e4a4c539b419f83802f1c7d.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAeWVoYW9jaGVuZzUyMA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> new_sheet<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> new_sheet<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;I&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> key<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;J&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> key<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;K&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    new_sheet<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;z&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;0.00%&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h1 id="_6-将工作簿添加到工作表中"><a href="#_6-将工作簿添加到工作表中" class="header-anchor">#</a> 6.将工作簿添加到工作表中</h1> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">XLSX</span><span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">book_append_sheet</span><span class="token punctuation">(</span>new_book<span class="token punctuation">,</span> new_sheet<span class="token punctuation">,</span> <span class="token string">&quot;元器件仓库日报汇总&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token constant">XLSX</span><span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">book_append_sheet</span><span class="token punctuation">(</span>new_book<span class="token punctuation">,</span> new_sheet2<span class="token punctuation">,</span> <span class="token string">&quot;人员月份汇总&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h1 id="_7-下载最终的excel表格"><a href="#_7-下载最终的excel表格" class="header-anchor">#</a> 7.下载最终的<code>excel</code>表格</h1> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">XLSX</span><span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>new_book<span class="token punctuation">,</span> <span class="token string">&quot;元器件出入库报表.xls&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h1 id="_8-通过-xlsx-style-来设置单元格样式"><a href="#_8-通过-xlsx-style-来设置单元格样式" class="header-anchor">#</a> 8.通过 xlsx-style 来设置单元格样式</h1> <p>用户需要实现<code>单元格内容换行</code>、<code>设置单元格背景色</code>及<code>单元格内容居中</code>等功能。</p> <p>此时单纯的引入<code>sheetJs</code>是不能满足要求了，此时还需要一个<code>xlsx-js</code>的文件，专门用于处理<code>sheetJs</code>的样式问题。</p> <p>我从网上找了好久，终于找到了对应的文件。</p> <p>特别感谢大神的链接：
<a href="https://www.likecs.com/show-203708170.html" target="_blank" rel="noopener noreferrer">使用 js-xlsx 纯前端导出 excel:https://www.likecs.com/show-203708170.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>上面的地址内容超级详细，而且一步步的将内容引出并提供解决方案，这才是一篇好的技术博客，赞！！！</p> <p>直接上解决办法，有空的同学可以仔细阅读上面的博客链接。</p> <h1 id="_8-1-引入两个js-xlsx-extendscript-js和xlsx-full-min-js"><a href="#_8-1-引入两个js-xlsx-extendscript-js和xlsx-full-min-js" class="header-anchor">#</a> 8.1. 引入两个<code>js</code>——<code>xlsx.extendscript.js</code>和<code>xlsx.full.min.js</code></h1> <p>这两个文件其实可以通过使用<code>npm</code>的方式来安装到本地，然后就能从本地文件中找到响应的 js 了。</p> <h4 id="_8-1-1-通过npm-install-xlsx"><a href="#_8-1-1-通过npm-install-xlsx" class="header-anchor">#</a> 8.1.1 通过<code>npm install xlsx</code></h4> <p>安装后 dist 文件夹下有一个文件<code>xlsx.extendscript.js</code>,引入到项目中</p> <h4 id="_8-1-2-通过npm-install-xlsx-style"><a href="#_8-1-2-通过npm-install-xlsx-style" class="header-anchor">#</a> 8.1.2 通过<code>npm install xlsx-style</code></h4> <p>安装后 dist 文件夹下有一个文件<code>xlsx.full.min.js</code>，引入到项目中</p> <p>大神提供的技术博客中，还提供了一个关于导出的封装后的<code>js</code>,叫<code>export.js</code>文件。这个文件中的内容并不多，可以单独引入，也可以直接将函数拷贝到页面上，我是直接拷贝的。下面会讲到。</p> <h1 id="_8-2-上面的两个js暴漏出来的变量有冲突-都是xlsx-此时需要更改其中一个的变量"><a href="#_8-2-上面的两个js暴漏出来的变量有冲突-都是xlsx-此时需要更改其中一个的变量" class="header-anchor">#</a> 8.2.上面的两个<code>js</code>暴漏出来的变量有冲突，都是<code>XLSX</code>,此时需要更改其中一个的变量</h1> <p>大神是直接更改的第一个文件的变量，我们可以直接跟随大神的操作步骤处理，防止出现不必要的麻烦。
<img src="https://img-blog.csdnimg.cn/fd8af6bb7a904f809fc56d6c4e95fdd4.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAeWVoYW9jaGVuZzUyMA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述">
下面介绍使用的详细步骤：</p> <h1 id="_8-3-详细使用步骤"><a href="#_8-3-详细使用步骤" class="header-anchor">#</a> 8.3.详细使用步骤</h1> <h3 id="_8-3-1-通过ref获取页面上的table组件"><a href="#_8-3-1-通过ref获取页面上的table组件" class="header-anchor">#</a> 8.3.1 通过<code>ref</code>获取页面上的<code>table</code>组件</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> table_dom <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">[</span><span class="token string">&quot;table1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>$el<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_8-3-2-设置开头空几行属性-不需要空则设置为-0-行"><a href="#_8-3-2-设置开头空几行属性-不需要空则设置为-0-行" class="header-anchor">#</a> 8.3.2 设置开头空几行属性，不需要空则设置为 0 行</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> opt <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">rowIndex</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">//开头空0行</span>
<span class="token keyword">const</span> new_sheet <span class="token operator">=</span> <span class="token constant">XLSX2</span><span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">table_to_sheet</span><span class="token punctuation">(</span>table_dom<span class="token punctuation">,</span> opt<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_8-3-3-设置单元格的居中及字号"><a href="#_8-3-3-设置单元格的居中及字号" class="header-anchor">#</a> 8.3.3 设置单元格的居中及字号</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> new_sheet<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;!&quot;</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token string">&quot;A1&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      new_sheet<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;s&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">font</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">sz</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token comment">//设置标题的字号</span>
          <span class="token literal-property property">bold</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//设置标题是否加粗</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">alignment</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">horizontal</span><span class="token operator">:</span> <span class="token string">&quot;center&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">vertical</span><span class="token operator">:</span> <span class="token string">&quot;center&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">wrapText</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">//设置标题水平竖直方向居中，并自动换行展示</span>
        <span class="token literal-property property">fill</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">fgColor</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">rgb</span><span class="token operator">:</span> <span class="token string">&quot;ebebeb&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">//设置标题单元格的背景颜色</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      new_sheet<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;s&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">font</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">sz</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">alignment</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">horizontal</span><span class="token operator">:</span> <span class="token string">&quot;center&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">vertical</span><span class="token operator">:</span> <span class="token string">&quot;center&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">wrapText</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>上面的代码：如果是<code>A1</code>则表示是第一行，我这边的第一行是合并单元格后的标题部分</p> <div class="language- extra-class"><pre><code>1. `font`：设置的是字体方面的样式
2. font&gt;&gt;&gt; sz：设置的是字号
3. font&gt;&gt;&gt;bold：字体加粗
4. alignment：设置单元格的居中及自动换行
5. alignment&gt;&gt;&gt;horizontal:水平是否居中
6. alignment&gt;&gt;&gt;vertical:竖直是否居中
7. alignment&gt;&gt;&gt;wrapText:是否换行展示内容
8. fill：设置单元格的背景色等
9. fill&gt;&gt;&gt;fgColor：设置背景色
</code></pre></div><h3 id="_8-3-4-设置单元格的宽度-此时需要每个单元格都进行设置"><a href="#_8-3-4-设置单元格的宽度-此时需要每个单元格都进行设置" class="header-anchor">#</a> 8.3.4 设置单元格的宽度，此时需要每个单元格都进行设置</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>new_sheet<span class="token punctuation">[</span><span class="token string">'!cols'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
   <span class="token punctuation">{</span> <span class="token literal-property property">wpx</span><span class="token operator">:</span> <span class="token number">40</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">wpx</span><span class="token operator">:</span> <span class="token number">40</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">wpx</span><span class="token operator">:</span> <span class="token number">40</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">wpx</span><span class="token operator">:</span> <span class="token number">60</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">wpx</span><span class="token operator">:</span> <span class="token number">100</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>如果相同的宽度比较多，则可以通过<code>new Array.(20)fill({wpx:xxx})</code>的方式来一次性添加 20 个相同的宽度，这样会简单一些。</p> <h3 id="_8-3-5-添加百分数-需要提前确定是哪几列需要添加-然后遍历时单独处理"><a href="#_8-3-5-添加百分数-需要提前确定是哪几列需要添加-然后遍历时单独处理" class="header-anchor">#</a> 8.3.5 添加百分数——<code>%</code>，需要提前确定是哪几列需要添加<code>%</code>，然后遍历时单独处理</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> new_sheet<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> new_sheet<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>
    key<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;S&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span>
    key<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;T&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span>
    key<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;U&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span>
    key<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;V&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    new_sheet<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;z&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;0.00%&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_8-3-6-将工作簿添加到工作表中"><a href="#_8-3-6-将工作簿添加到工作表中" class="header-anchor">#</a> 8.3.6 将工作簿添加到工作表中</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">XLSX2</span><span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">book_append_sheet</span><span class="token punctuation">(</span>new_book<span class="token punctuation">,</span> new_sheet<span class="token punctuation">,</span> <span class="token string">&quot;出库日报&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_8-3-7-导出工作表"><a href="#_8-3-7-导出工作表" class="header-anchor">#</a> 8.3.7 导出工作表</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>	<span class="token keyword">var</span> wopts <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">bookType</span><span class="token operator">:</span> <span class="token string">'xlsx'</span><span class="token punctuation">,</span> <span class="token comment">// 要生成的文件类型</span>
        <span class="token literal-property property">bookSST</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否生成Shared String Table，官方解释是，如果开启生成速度会下降，但在低版本IOS设备上有更好的兼容性</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'binary'</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> wbout <span class="token operator">=</span> <span class="token constant">XLSX</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>new_book<span class="token punctuation">,</span> wopts<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">s2ab</span><span class="token punctuation">(</span>wbout<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;application/octet-stream&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 字符串转ArrayBuffer</span>
    <span class="token comment">// 导出excel文件 如导出后的文件不能打开，请将后缀替换为 .xls</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">openDownloadDialog</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getDateString</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)广德云仓出库报表.xlsx</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 导出excel文件 如导出后的文件不能打开，请将后缀替换为 .xls</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>上面用到了<code>this.s2ab</code>方法：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">s2ab</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> view <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">!=</span> s<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> view<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> buf<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>还用到了<code>openDownloadDialog</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">openDownloadDialog</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> saveName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> url <span class="token operator">==</span> <span class="token string">'object'</span> <span class="token operator">&amp;&amp;</span> url <span class="token keyword">instanceof</span> <span class="token class-name">Blob</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        url <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建blob地址</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> aLink <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    aLink<span class="token punctuation">.</span>href <span class="token operator">=</span> url<span class="token punctuation">;</span>
    aLink<span class="token punctuation">.</span>download <span class="token operator">=</span> saveName <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">;</span> <span class="token comment">// HTML5新增的属性，指定保存文件名，可以不要后缀，注意，file:///模式下不会生效</span>
    <span class="token keyword">var</span> event<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>MouseEvent<span class="token punctuation">)</span> event <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MouseEvent</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        event <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createEvent</span><span class="token punctuation">(</span><span class="token string">'MouseEvents'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        event<span class="token punctuation">.</span><span class="token function">initMouseEvent</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> window<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    aLink<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>完成！！！
导出的<code>excel</code>如下：
<img src="https://img-blog.csdnimg.cn/b5f7fff2f092463ea6aae37cc08599ae.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAeWVoYW9jaGVuZzUyMA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p> <h1 id="sheetjs-实现表格的导入"><a href="#sheetjs-实现表格的导入" class="header-anchor">#</a> sheetJs 实现表格的导入</h1> <h2 id="_1-关于sheetjs的部分资料"><a href="#_1-关于sheetjs的部分资料" class="header-anchor">#</a> 1.关于<code>sheetJs</code>的部分资料</h2> <h4 id="_1-1-sheetjs官网"><a href="#_1-1-sheetjs官网" class="header-anchor">#</a> 1.1 <code>sheetJs</code>官网</h4> <p><a href="http://sheetjs.com" target="_blank" rel="noopener noreferrer">sheetJs 官网地址：http://sheetjs.com<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/sheetjs/js-xlsx" target="_blank" rel="noopener noreferrer">sheetJs 的 github 地址：https://github.com/sheetjs/js-xlsx<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="_1-2-其他大神关于sheetjs的技术文章"><a href="#_1-2-其他大神关于sheetjs的技术文章" class="header-anchor">#</a> 1.2 其他大神关于<code>sheetJS</code>的技术文章</h4> <p><a href="https://blog.csdn.net/marko_zheng/article/details/79454756" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/marko_zheng/article/details/79454756<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.jianshu.com/p/74d405940305" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/74d405940305<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="_2-关于excel的导入功能"><a href="#_2-关于excel的导入功能" class="header-anchor">#</a> 2.关于<code>excel</code>的导入功能</h2> <p>之前我遇到的导入功能，都是通过<code>input</code>组件设置<code>type='file'</code>来处理。现在也是如此。</p> <h4 id="_2-1-通过input组件来实现文件的导入"><a href="#_2-1-通过input组件来实现文件的导入" class="header-anchor">#</a> 2.1 通过<code>input</code>组件来实现文件的导入</h4> <p><code>html</code>部分添加下面的代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token string">&quot;opacity: 0&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>input
    v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;fileInput&quot;</span>
    ref<span class="token operator">=</span><span class="token string">&quot;fileUpload&quot;</span>
    accept<span class="token operator">=</span><span class="token string">&quot;.xls,.xlsx,.csv&quot;</span>
    style<span class="token operator">=</span><span class="token string">&quot;width: 0px; height: 0px&quot;</span>
    type<span class="token operator">=</span><span class="token string">&quot;file&quot;</span>
    v<span class="token operator">-</span>on<span class="token operator">:</span>change<span class="token operator">=</span><span class="token string">&quot;addFile($event)&quot;</span>
  <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><code>js</code>部分添加下面的代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span><span class="token punctuation">{</span>
		<span class="token literal-property property">fileInput</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token literal-property property">methods</span><span class="token operator">:</span><span class="token punctuation">{</span>
	<span class="token comment">//导入excel文件</span>
	 <span class="token function">importEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	     <span class="token keyword">this</span><span class="token punctuation">.</span>fileInput <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	     <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	         <span class="token comment">//页面渲染完成后，触发点击事件，弹出对话框</span>
	         <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>fileUpload<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	     <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	 <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token function">addFile</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">var</span> files <span class="token operator">=</span> file<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
     <span class="token comment">//此时的files就是导入后的文件了，此时可以打印一下看下格式</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><img src="https://img-blog.csdnimg.cn/56e036b5299c4025971e71e7c1d80f1d.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAeWVoYW9jaGVuZzUyMA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p> <h4 id="_2-2-通过filereader方法来处理导入后的文件"><a href="#_2-2-通过filereader方法来处理导入后的文件" class="header-anchor">#</a> 2.2 通过<code>FileReader</code>方法来处理导入后的文件</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">addFile</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> files <span class="token operator">=</span> file<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> fileReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  fileReader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ev'</span><span class="token punctuation">,</span> ev<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> workbook <span class="token operator">=</span> <span class="token constant">XLSX2</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'array'</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'workbook'</span><span class="token punctuation">,</span> workbook<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> wsname <span class="token operator">=</span> workbook<span class="token punctuation">.</span>SheetNames<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//取第一张表</span>
      <span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token constant">XLSX2</span><span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">sheet_to_json</span><span class="token punctuation">(</span>workbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">[</span>wsname<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//生成json表格内容</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ws<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  fileReader<span class="token punctuation">.</span><span class="token function">readAsArrayBuffer</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>通过上面的代码，可以打印出来最后的<code>ws</code>字段
<img src="https://img-blog.csdnimg.cn/51743beb31a84a7b81915b55292b4563.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAeWVoYW9jaGVuZzUyMA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p> <p>此时数据是一个数组，我们可以获取数组的第一项，也就是表头，可以根据表头的内容判断表格的内容是否正确。</p> <p>下面介绍可以将上面的数据格式转化为数组的具体方法：</p> <p>最终效果如下：
<img src="https://img-blog.csdnimg.cn/d9bd03cfdde34ed0ae297dd8e531198e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAeWVoYW9jaGVuZzUyMA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述">
代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">addFile</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> files <span class="token operator">=</span> file<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//虽然我的input支持多个上传，但是此时我还是只处理了第一个文件，多选的参数可以去掉了</span>
  <span class="token keyword">var</span> name <span class="token operator">=</span> files<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
  <span class="token keyword">var</span> suffix <span class="token operator">=</span> name<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>name<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>suffix <span class="token operator">==</span> <span class="token string">&quot;xlsx&quot;</span> <span class="token operator">||</span> suffix <span class="token operator">==</span> <span class="token string">&quot;.xls&quot;</span> <span class="token operator">||</span> suffix <span class="token operator">==</span> <span class="token string">&quot;.csv&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fileConvertToWorkbook</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">workbook</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token keyword">var</span> fileData <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
              <span class="token keyword">const</span> sheet2JSONOpts <span class="token operator">=</span> <span class="token punctuation">{</span>
                  <span class="token literal-property property">defval</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
                  <span class="token comment">//raw:false,</span>
              <span class="token punctuation">}</span><span class="token punctuation">;</span>
              workbook<span class="token punctuation">.</span>SheetNames<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                  <span class="token keyword">var</span> axlsxArr <span class="token operator">=</span> <span class="token constant">XLSX2</span><span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">sheet_to_json</span><span class="token punctuation">(</span>
                      workbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">[</span>workbook<span class="token punctuation">.</span>SheetNames<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                      sheet2JSONOpts
                  <span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token keyword">if</span> <span class="token punctuation">(</span>axlsxArr<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                      <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;导入得Excel中没有数据，请校验。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                      <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>fileUpload<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                      <span class="token keyword">return</span><span class="token punctuation">;</span>
                  <span class="token punctuation">}</span>
                  fileData<span class="token punctuation">[</span>item<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">xlsxArrToTableArr</span><span class="token punctuation">(</span>axlsxArr<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>fileUpload<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'fileData'</span><span class="token punctuation">,</span> fileData<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>fileUpload<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;导入文件格式不对！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">//将文档流转化为base64格式</span>
<span class="token function">fileConvertToWorkbook</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> <span class="token function-variable function">fixdata</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
            l <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
            w <span class="token operator">=</span> <span class="token number">10240</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> l <span class="token operator">&lt;</span> data<span class="token punctuation">.</span>byteLength <span class="token operator">/</span> w<span class="token punctuation">;</span> <span class="token operator">++</span>l<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            o <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>
                <span class="token keyword">null</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>l <span class="token operator">*</span> w<span class="token punctuation">,</span> l <span class="token operator">*</span> w <span class="token operator">+</span> w<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        o <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>l <span class="token operator">*</span> w<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> o<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            reader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">renderEvent</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> data <span class="token operator">=</span> renderEvent<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
                <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token function">fixdata</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span>
                    <span class="token constant">XLSX</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token function">btoa</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;base64&quot;</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">cellDates</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">dateNF</span><span class="token operator">:</span> <span class="token string">&quot;yyyy-MM-dd HH:MM:SS&quot;</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
            reader<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
            reader<span class="token punctuation">.</span><span class="token function">readAsArrayBuffer</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function">xlsxArrToTableArr</span><span class="token punctuation">(</span><span class="token parameter">xlsxArr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tableArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> maxLength <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> maxLengthIndex <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    xlsxArr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        length <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>maxLength <span class="token operator">&lt;</span> length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            maxLength <span class="token operator">=</span> length<span class="token punctuation">;</span>
            maxLengthIndex <span class="token operator">=</span> index<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> tableHeaderKeys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>xlsxArr<span class="token punctuation">[</span>maxLengthIndex<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> tableHeader <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    tableHeaderKeys <span class="token operator">&amp;&amp;</span> tableHeaderKeys<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">head</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        tableHeader<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>xlsxArr<span class="token punctuation">[</span>maxLengthIndex<span class="token punctuation">]</span><span class="token punctuation">[</span>head<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> rowItem <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    xlsxArr<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xlsxArr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        rowItem <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> maxLength<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            rowItem<span class="token punctuation">[</span>tableHeader<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> item<span class="token punctuation">[</span>tableHeaderKeys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        tableArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>rowItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">header</span><span class="token operator">:</span> tableHeader<span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> tableArr<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br></div></div><p>特别需要注意的是，我这边的表格都是有一个合并的表头的，因此我在<code>xlsxArrToTableArr</code>函数中去掉了开头的一项，在进行获取表格的数据，否则会把表头也加入到表格数据中。</p> <p><img src="https://img-blog.csdnimg.cn/b7d530c3986f4ecf86ba242a154ca0d5.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAeWVoYW9jaGVuZzUyMA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p> <p><img src="https://img-blog.csdnimg.cn/f2e43dc1aa9549c58d9c0e7e0f1d3f80.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAeWVoYW9jaGVuZzUyMA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p> <p>如果开头没有合并的表头，或者有合并行的表头，则需要单独处理了。
<img src="https://img-blog.csdnimg.cn/b03024ecc42f427dbb6347d6dfad57a0.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAeWVoYW9jaGVuZzUyMA==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p> <p>完成！！！</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/jquery/ImportOrExport.html" class="prev">
        导入与导出
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.d1c6ccf3.js" defer></script><script src="/assets/js/2.2a0560b8.js" defer></script><script src="/assets/js/22.de8fc4c8.js" defer></script>
  </body>
</html>
